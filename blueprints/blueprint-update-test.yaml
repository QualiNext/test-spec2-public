spec_version: 2

inputs:
  compute_service_name:
    type: agent
  inputnew:
    type: string
    default: vlabla
  inputnew2:
    type: string
    default: bla2
  input-no-default:
    type: string

outputs:
  output1:
    value: "http://www.google.com"
    kind: link
    quick: true
  output2:
    value: '{{.inputs.compute_service_name}}'
    kind: link
    quick: true
  output3:
    value: 'http://my-env-{{ sandboxid }}/some/api/new'
    kind: link
    quick: true
  output4:
    value: '{{.grains.tf2.outputs.output2}}'    
    

grains: 
  tf2:
    kind: terraform
    tf-version: 1.5.3
    spec:
      source:
        path: terraform/simple-tf-module
        store: test-spec2-public
      agent:        
        name: '{{.inputs.compute_service_name}}'
      inputs:
        - test_input2: '{{.inputs.input-no-default}}'
        - tester: "yo"
      env-vars:
        - VAR1: VAL1
      # tfvars-files:
      #   - source:
      #       store: test-spec2-public
      #       path: terraform/sub-module/values.tfvars
      outputs:
        - output2
      scripts: 
        pre-tf-init:
          source:
            store: test-spec2-public
            path : scripts/print-env-vars.sh
          arguments: "value"
  tf3:
    kind: terraform
    tf-version: 1.5.3
    spec:
      source:
        path: terraform/simple-tf-module
        store: test-spec2-public
      agent:        
        name: '{{.inputs.compute_service_name}}'
      inputs:
        - test_input2: "input2"
        - tester: "yo"
      env-vars:
        - VAR1: VAL1
      # tfvars-files:
      #   - source:
      #       store: test-spec2-public
      #       path: terraform/sub-module/values.tfvars
      outputs:
        - output2   
  tf4:
    kind: terraform
    tf-version: 1.5.3
    spec:
      source:
        path: terraform/simple-tf-module
        store: test-spec2-public
      agent:        
        name: '{{.inputs.compute_service_name}}'
      inputs:
        - test_input2: "input2"
        - tester: "yo"
      env-vars:
        - VAR1: VAL1
      # tfvars-files:
      #   - source:
      #       store: test-spec2-public
      #       path: terraform/sub-module/values.tfvars
      outputs:
        - output2  
      #     source:
      #       store: test-spec2-public
      #       path : scripts/tomerv_user_script.sh
      #     arguments: "value" 
